<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
      PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.board02.comment.repository.CommentRepository">
	<resultMap id="commentsResult" type="commentVO">
		<result property="commentNO" column="commentNO" />
		<result property="contents" column="contents" />
		<result property="replyId" column="replyId" />
		<result property="creDate" column="creDate" />
		<result property="articleNO" column="articleNO" />
		<result property="pCommentNO" column="pCommentNO" />
	</resultMap>

	<!-- 댓글 조회 -->
<!-- 	
<select id="selectAllCommentsList" parameterType="int"
	resultMap="commentsResult">
    <![CDATA[
      SELECT commentNO,
             comments, 
             articleNO, 
             replyID, 
             creDate 
      FROM t_comments1
      WHERE
	    articleNO = #{articleNO}
	  ORDER BY creDate desc
    ]]>
</select>
 -->
 <!-- 계층형 쿼리문으로 댓글 조회 -->
	 <select id="selectAllCommentsList" parameterType="int" resultMap="commentsResult">
		 <![CDATA[
			 SELECT LEVEL,
			    commentNO,
			    pCommentNO,
			    LPAD(' ',4*(LEVEL-1)) || contents contents,
			    creDate,
			    replyId
			FROM t_comments1
			WHERE articleNO = #{articleNO}
			START WITH pCommentNO = 0
			CONNECT BY PRIOR commentNO=pCommentNO
			ORDER SIBLINGS BY commentNO DESC
		 ]]>
	</select>
	
	
<!-- 
	<insert id="insertNewComment" parameterType="commentVO">
	    <![CDATA[
	      INSERT INTO t_comments1(commentNO, 
	                               comments, 
	                               replyID, 
	                               articleNO)
	      VALUES(#{commentNO},
	              #{comments},
	      		  #{replyID}, 
	      		  #{articleNO})
	    ]]>
	</insert>
 -->
 
	<insert id="insertNewComment" parameterType="commentVO">
	    <![CDATA[
	      INSERT INTO t_comments1(commentNO, 
	                               contents, 
	                               replyId, 
	                               articleNO,
	                               pCommentNO)
	      VALUES(#{commentNO},
	              #{contents},
	      		  #{replyId}, 
	      		  #{articleNO},
	      		  #{pCommentNO})
	    ]]>
	</insert>
 
 	
	<select id="selectNewCommentNO" resultType="int">
		<![CDATA[
			SELECT  NVL(MAX(commentNO), 0) + 1 FROM t_comments1		
		]]>
	</select>
	
	<select id="selectCommentById" parameterType="int" resultType="commentVO">
		<![CDATA[
			SELECT  commentNO,
			        contents,
			        replyId,
			        articleNO,
			        creDate
			FROM  t_comments1
			WHERE
			  commentNO = #{commentNO}
		]]>
	</select>
	
	<update id="updateComment" parameterType="commentVO">
	    <![CDATA[
		      UPDATE t_comments1 
		      	SET contents = #{contents}
		      WHERE
		     	commentNO = #{commentNO}
	    ]]>
	</update>
	
	<delete id="deleteComment" parameterType="commentVO">
	    <![CDATA[
		      DELETE FROM t_comments1 
		      WHERE
		      commentNO = #{commentNO}
	    ]]>
	</delete>
	
	<select id="selectNewCGroupNO" resultType="int">
		<![CDATA[
			SELECT  NVL(MAX(cGroupNO), 0) + 1 FROM t_comments1		
		]]>
	</select>	
	
</mapper>

