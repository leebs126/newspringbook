<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bookshop01.cart.dao.CartDAO">
	<!-- 리절트 맵 정의 -->
	<resultMap id="cartResult" type="CartVO">
		<result property="cartId" column="cart_id" />
		<result property="goodsId" column="goods_id" />
		<result property="goodsPrice" column="goods_price" />
		<result property="memberId" column="member_id" />
		<result property="cartGoodsQty" column="cart_goods_qty" />
		<result property="creDate" column="creDate" />
	</resultMap>
	
	<resultMap id="goodsResult" type="GoodsVO">
		<result property="goodsId" column="goods_id" />
		<result property="goodsTitle" column="goods_title" />
		<result property="goodsWriter" column="goods_writer" />
		<result property="goodsPrice" column="goods_price" />
		<result property="goodsPublisher" column="goods_publisher" />

		<result property="goodsStatus" column="goods_status" />
		<result property="goodsSalesPrice" column="goods_sales_price" />
		<result property="goodsPublishedDate" column="goods_published_date" />
		<result property="goodsTotalPage" column="goods_total_page" />
		<result property="goodsIsbn" column="goods_isbn" />
		<result property="goodsDeliveryPrice" column="goods_delivery_price" />
		<result property="goodsDeliveryDate" column="goods_delivery_date" />

		<result property="goodsFileName" column="fileName" />
		<result property="goodsSort" column="goods_sort" />
		<result property="goodsWriterIntro" column="goods_writer_intro" />
		<result property="goodsContentsOrder" column="goods_contents_order" />
		<result property="goodsIntro" column="goods_intro" />
	</resultMap>

	<select id="selectCartList"  parameterType="cartVO"  resultMap="cartResult"   >
	    <![CDATA[
		SELECT  cart_id, 
			  	goods_id, 
			  	member_id, 
			  	cart_goods_qty, 
			  	goods_price, 
			  	creDate 
		FROM t_shopping_cart 
		WHERE
		member_id=#{memberId} 
		]]>
		ORDER BY goods_id DESC
	</select>

	<select id="selectGoodsList" resultMap="goodsResult" parameterType="java.util.Map">
      <![CDATA[
          SELECT g.*,d.fileName from t_shopping_goods g, t_goods_detail_image d
          WHERE
          g.goods_id=d.goods_id
          AND d.filetype='main_image'
          AND g.goods_id IN
      ]]>
		<foreach item="item" collection="list" open="(" separator="," close=")">
			#{item.goodsId}
		</foreach>
		ORDER BY g.goods_creDate DESC
	</select>

	<select id="selectCountInCart" resultType="String" parameterType="cartVO">
	    <![CDATA[
		    SELECT DECODE(COUNT(*), 0, 'false', 'true') 
		    FROM t_shopping_cart
			WHERE 
			goods_id=#{goodsId}
			AND member_id=#{memberId} 

    	]]>
	</select>

	<insert id="insertGoodsInCart" parameterType="cartVO">
	    <![CDATA[
	    	INSERT INTO t_shopping_cart(cart_id,
	    	                           goods_id,
	    	                           member_id,
	    	                           goods_price)
	        				 VALUES(#{cartId},
							        #{goodsId},
							        #{memberId},
							        #{goodsPrice})
    	]]>
	</insert>

	<update id="updateCartGoodsQty" parameterType="cartVO">
	    <![CDATA[
			UPDATE t_shopping_cart
		       SET cart_goods_qty=#{cartGoodsQty}
	 	       WHERE
	 	       member_id=#{memberId}
		       AND goods_id=#{goodsId}
    	]]>
	</update>
	<delete id="deleteCartGoods" parameterType="int">
	    <![CDATA[
	      DELETE FROM t_shopping_cart
	      WHERE cart_id=#{cartId}
    	]]>
	</delete>
	
	<select id="selectMaxCartId" resultType="int">
	    <![CDATA[
			SELECT NVL(MAX(cart_id), 0) + 1 FROM t_shopping_cart 
    	]]>
	</select>

</mapper>
