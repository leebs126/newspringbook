<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.bookshop01.admin.order.dao.AdminOrderDAO">
<resultMap id="orderResult" type="OrderVO">
		<result property="orderId" column="order_id" />
		<result property="memberId" column="member_id" />
		<result property="goodsId" column="goods_id" />
		<result property="goodsTitle" column="goods_title" />
		<result property="goodsPrice" column="goods_price" />
		<result property="goodsSalesPrice" column="goods_sales_price" />
		<result property="orderTotalPrice" column="order_total_price" />
		<result property="orderGoodsQty" column="order_goods_qty" />
		
		<result property="ordererName" column="orderer_name" />
		<result property="receiverName" column="receiver_name" />
		<result property="receiverHp1" column="receiver_hp1" />
		<result property="receiverHp2" column="receiver_hp2" />
		<result property="receiverHp3" column="receiver_hp3" />
		
		<result property="receiverTel1" column="receiver_tel1" />
		<result property="receiverTel2" column="receiver_tel2" />
		<result property="receiverTel3" column="receiver_tel3" />
		<result property="deliveryAddress" column="delivery_address" />
		<result property="deliveryMessage" column="delivery_message" />
		
		<result property="deliveryMethod" column="delivery_method" />
		<result property="giftWrapping" column="gift_wrapping" />
		<result property="payMethod" column="pay_method" />
		<result property="cardComName" column="card_com_name" />
		<result property="cardPayMonth" column="card_pay_month" />
		
		<result property="payOrdererHpNum" column="pay_orderer_hp_num" />
		<result property="payOrderTime" column="pay_order_time" />
		<result property="deliveryState" column="delivery_state" />
		<result property="finalTotalPrice" column="final_total_price" />
		<result property="goodsQty" column="goods_qty" />
		
		<result property="goodsFileName" column="goods_fileName" />
	</resultMap>
  <resultMap id="memberResult" type="memberVO">
		<result property="memberId" column="member_id" />
		<result property="memberPw" column="member_pw" />
		<result property="memberName" column="member_name" />
		<result property="memberGender" column="member_gender" />
		
		<result property="memberBirthY" column="member_birth_y" />
		<result property="memberBirthM" column="member_birth_m" />
		<result property="memberBirthD" column="member_birth_d" />
		
		<result property="memberBirthGn" column="member_birth_gn" />
		<result property="tel1" column="tel1" />
		<result property="tel2" column="tel2" />
		<result property="tel3" column="tel3" />
		
		<result property="hp1" column="hp1" />
		<result property="hp2" column="hp2" />
		<result property="hp3" column="hp3" />
		<result property="smsstsYn" column="smssts_yn" />
		<result property="email1" column="email1" />
		<result property="email2" column="email2" />
		<result property="emailstsYn" column="emailsts_yn" />
		
		<result property="zipcode" column="zipcode" />
		<result property="roadAddress" column="roadAddress" />
		<result property="jibunAddress" column="jibunAddress" />
		<result property="namujiAddress" column="namujiAddress" />
		<result property="joinDate" column="joinDate" />
	</resultMap>

<select id="selectNewOrdersList" resultMap="orderResult"   parameterType="java.util.HashMap"  >
SELECT so.* FROM 
t_shopping_order so
WHERE so.order_id IN(
    SELECT order_id 
    FROM(
        SELECT * 
        FROM
            (SELECT   rowNum AS recNum, order_id
                FROM(
                     SELECT DISTINCT order_id 
                            FROM t_shopping_order
                            WHERE TO_CHAR(pay_order_time,'yyyy-mm-dd')  BETWEEN #{beginDate} AND #{endDate}
			                <if test="searchType=='ordererId'">
			                  AND orderer_id=#{searchWord}
			                </if>
			                <if test="searchType=='ordererName'">
			                  AND orderer_name=#{searchWord}
			                </if>
			                <if test="searchType=='ordererHpNum'">
			                   AND pay_orderer_hp_num=#{searchWord} 
			                </if>                                    
                            ORDER BY  order_id DESC
                ) 
                
        )    
        WHERE
        1=1
        AND
        recNum BETWEEN (#{section}-1)*100+ (#{pageNum}-1)*10+1 AND (#{section}-1)*100+(#{pageNum})*10
    )
    
)
ORDER BY  order_id DESC          
</select>

<select id="selectTotalOrders" resultType="int" parameterType="java.util.Map">
  <![CDATA[
    SELECT COUNT(DISTINCT order_id) 
    FROM t_shopping_order 
    WHERE TO_CHAR(pay_order_time, 'YYYY-MM-DD') BETWEEN #{beginDate} AND #{endDate}
  ]]>
</select>

<update id="updateDeliveryState" parameterType="java.util.Map" >
   UPDATE t_shopping_order
    <set> 
      <if test=" deliveryState!='' and deliveryState!=null">
        delivery_state=#{deliveryState}
      </if>
    </set>
    WHERE 
    order_id=#{orderId}
</update>	

<select id="selectAdminOrderDetail" resultMap="orderResult"   parameterType="int"  >
    <![CDATA[
	    SELECT * FROM t_shopping_order
        WHERE order_id=#{orderId}
	]]>
</select>
	
<select id="selectSearchOrderDetail" resultMap="orderResult"   parameterType="java.util.Map">
      SELECT * FROM (
	    SELECT rowNum AS recNum,t.*
	       from (
	              SELECT  *  FROM t_shopping_order 
	              WHERE TO_CHAR(pay_order_time,'yyyy-mm-dd')  BETWEEN #{beginDate} AND #{endDate}
	                <if test="searchType=='ordererId'">
	                  AND member_id=#{searchWord}
	                </if>
	                <if test="searchType=='ordererName'">
	                  AND orderer_name=#{searchWord}
	                </if>
	                <if test="searchType=='ordererHpNum'">
	                   AND pay_orderer_hp_num=#{searchWord} 
	                </if>
	              ORDER BY PAY_ORDER_TIME DESC
			    ) t
		)							
	WHERE				
recNum BETWEEN (#{section}-1)*100+(#{pageNum}-1)*10+1 AND (#{section}-1)*100+(#{pageNum})*10
</select>	
	
   <select id="selectOrderer" resultMap="memberResult"  parameterType="String"  >
	    <![CDATA[
			SELECT * FROM t_shopping_member 
			WHERE member_id=#{memberId}
		]]>
	</select>	
	
	
</mapper>

